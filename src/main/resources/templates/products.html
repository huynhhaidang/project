<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{fragments :: head('Tất cả sản phẩm')}"></head>
<body>
<div th:replace="~{fragments :: svg-sprite}"></div>
<div th:replace="~{fragments :: preloader}"></div>
<div th:replace="~{fragments :: search-box}"></div>
<div th:replace="~{fragments :: header}"></div>

<section class="py-4">
  <div class="container-lg">
    <div class="d-flex align-items-center justify-content-between flex-wrap mb-4">
      <div>
        <h1 class="mb-1">Tất cả sản phẩm</h1>
        <p class="text-muted m-0">Khám phá toàn bộ điện thoại, laptop và phụ kiện</p>
      </div>
      <a class="btn btn-outline-gray" th:href="@{/}">Về trang chủ</a>
    </div>

    <form class="filter-bar row g-3 align-items-end" method="get" th:action="@{/products}">
      <div class="col-lg-4">
        <label class="form-label">Tìm kiếm</label>
        <input type="text" name="keyword" th:value="${keyword}" placeholder="Tên sản phẩm..." class="form-control">
      </div>
      <div class="col-lg-4">
        <label class="form-label">Danh mục</label>
        <select name="category" class="form-select">
          <option value="">Tất cả danh mục</option>
          <option th:each="c : ${categories}" th:value="${c.name}" th:text="${c.name}" th:selected="${c.name == selectedCategory}"></option>
        </select>
      </div>
      <div class="col-lg-2">
        <button type="submit" class="btn btn-black w-100">Lọc</button>
      </div>
    </form>

    <div class="product-content padding-small mt-4">
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4">
        <div class="col mb-4" th:each="p : ${products}">
          <div class="product-card position-relative">
            <div class="card-img">
              <img th:src="${p.imageUrl}" alt="product-item" class="product-image img-fluid">
              <div class="cart-concern position-absolute d-flex justify-content-center">
                <div class="cart-button d-flex gap-2 justify-content-center align-items-center">
                  <form th:if="${p.stock > 0 && p.active}" th:action="@{/cart/add/{id}(id=${p.id})}" method="post">
                    <button type="submit" class="btn btn-light">
                      <svg class="shopping-carriage"><use xlink:href="#shopping-carriage"></use></svg>
                    </button>
                  </form>
                  <a class="btn btn-light" th:href="@{/products/{id}(id=${p.id})}">
                    <svg class="quick-view"><use xlink:href="#quick-view"></use></svg>
                  </a>
                </div>
              </div>
            </div>
            <div class="card-detail d-flex justify-content-between align-items-center mt-3">
              <h3 class="card-title fs-6 fw-normal m-0">
                <a th:href="@{/products/{id}(id=${p.id})}" th:text="${p.name}">Tên</a>
              </h3>
              <span class="card-price fw-bold" th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</span>
            </div>
            <div class="text-muted small" th:if="${p.stock == 0 || !p.active}">Hết hàng</div>
          </div>
        </div>
      </div>
    </div>

    <div class="pagination" th:if="${page != null}">
      <a class="btn btn-outline-gray btn-sm" th:if="${page.hasPrevious()}"
         th:href="@{/products(page=${page.number - 1}, keyword=${keyword}, category=${selectedCategory})}">Trước</a>
      <span>Trang <strong th:text="${page.number + 1}"></strong> / <span th:text="${page.totalPages}"></span></span>
      <a class="btn btn-outline-gray btn-sm" th:if="${page.hasNext()}"
         th:href="@{/products(page=${page.number + 1}, keyword=${keyword}, category=${selectedCategory})}">Sau</a>
    </div>
  </div>
</section>

<div th:replace="~{fragments :: footer}"></div>
<div th:replace="~{fragments :: footer-scripts}"></div>
</body>
</html>
